<meta charset="utf-8">
<body style="background-color:#000;margin:0">
<canvas id=a style='touch-action:none'></canvas>
<script>

// ♛ Queens Gambit By KilledByAPixel

// init shim variables 
d=document;b=d.body;c=a.getContext`2d`;
a.width = innerWidth;
a.height = innerHeight;
onresize = e => location.reload();

C=function(t,l,s,o,f,p){this.b=(i=>{e+=1<p,c.font=2*f+"px'",c.fillStyle="hsl("+80*(p-2?4+p:h/9)+" 90%"+(-1<p?50:99)+"%)",c.fillText(p-2?"❀♛♥♛♞1♟♜♝"[m>9?0:3+p]:" "+m,s-f,o+f/2),s+=t*=s+t>a.width|0>s+t?-.5:!p|3==p?.8:1,o+=l*=o+l>a.height|0>o+l?-.5:!p|3==p?.8:1,0>p|1==p&&(f*=13<f?-1>p?.9:.99:n.splice(n.indexOf(this),1)),p||(c.fillText("♛x"+I,9,49),t+=r[2]-r[0],l+=r[3]-r[1],0==h%5&&n.push(new C((u-s)/9,(v-o)/9,s,o,18,-1))),n.map(n=>n.a(s,o,f,p,this))}),this.a=((e,a,c,d,u)=>{0<p&-3<d&1>d&(!!d|9<h)&&(!d&60<h&!w(x)&&(3==p&&(t+=0>e-s?-9:9,l+=0>a-o?-9:9),4==p&&(40<++f&&n.push(new C(0,0,s,o,f=25,3)),l=(t=w(2)?0:w(2)?-4:4)?0:w(2)?-4:4),5==p&&(w(9)||n.push(new C((e-s)/80,(a-o)/80,s,o,50,1)),t=w(2)?-4:4,l=w(2)?-4:4)),(e-s)**2<(f+c)**2&&(a-o)**2<(f+c)**2&&(n.push(new C(0,0,s,o,2*f,-3)),d+2&&n.splice(n.indexOf(u),1),n.splice(n.indexOf(this),1),d?0:y=--I))})},setInterval(t=>{if(c.fillStyle="#0005",c.fillRect(0,0,a.width,a.height),e=0,n.map(n=>n.b()),0==++h%50&&9<x&&--x,!e||y&&0<I)for(i=e||25*++m,x=40-m,y=h=0,n=[],9>=m&&n.push(new C(0,0,a.width/2,a.height/2,25,0,n.push(new C(0,0,a.width/2,a.height/2,a.width/9,-2))));i--;)n.push(new C(0,0,w(a.width),w(a.height),25+w(9),w(2)+!w(3)+!w(3)+2))},16),onkeydown=n=>r[n.keyCode%37]=2,onkeyup=n=>r[n.keyCode%37]=0,onmousemove=n=>{u=n.x,v=n.y},r=[m=h=u=v=y=n=[],0,0,0],I=3,w=n=>Math.random()*n|0

// ENHANCE - wasd control
W=x=>x==87?1:x==83?3:x==65?0:x==68?2:4
onkeydown   =x=>{r[W(x.keyCode)]=2;r[x.keyCode%37]=2;}
onkeyup     =x=>{r[W(x.keyCode)]=0;r[x.keyCode%37]=0;}

</script>