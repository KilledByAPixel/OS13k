<head>
<title>OS13k - A tiny pseudo operating system for JS13k</title>
<meta charset=utf-8>
<style>
*    { font-family:arial; }
body { overflow:hidden; background:linear-gradient(#223,#322); }
.title
{
font-size:300;
font-family:impact;
color:#0002;
height:100%;
display:flex;
align-items:center;
justify-content:center;
user-select:none;
pointer-events:none;
}
</style>
<template id=templateIcon>
<style>
:host
{
position:absolute;
display:flex;
align-items:center;
flex-direction:column;
user-select:none;
pointer-events:auto;
}
.icon
{
width:64;
height:64;
font-size:42;
background:linear-gradient(#fff,#999);
border-radius:9px;
box-shadow:4px 4px 5px;
overflow:hidden;
white-space:nowrap;
pointer-events:none;
display:flex;
align-items:center;
justify-content:center;
}
.name
{
position:absolute;
top:70;
text-align:center;
font-size:17;
color:#fff;
text-shadow:1px 1px 5px #000;
}
</style>
</template>
<template id=templateWindow>
<style>
:host
{
position:absolute;
user-select:none;
display:flex;
flex-direction:column;
box-shadow:9px 9px 9px;
background:#000;
border:2px solid;
overflow:hidden;
display:block;
}
.frame
{
position:relative;
width:100%;
height:100%;
border:none;
background:#fff;
overflow:hidden;
}
.titleBar
{
height:44;
font-size:30;
display:flex;
align-items:center;
white-space:nowrap;
overflow:hidden;
vertical-align: middle;
}
.name         { width:100%; height:100%; cursor:grab; display:flex; align-items:center;}
.folder       { background:#222; }
#full,#reload { width:40; }
.close        { width:28; }
.full:hover   { background:#fff; }
.reload:hover { background:#ff0; }
.close:hover  { background:#f00; }
span svg 
{
width: 100%;
pointer-events: none;
}
</style>
<svg width=0 height=0>
<symbol id=icon-full viewBox='0 0 10 10'>
<rect stroke=#000 stroke-width=.8 fill=none x=1 y=2 width=8 height=6 />
</symbol>
<symbol id=icon-reload viewBox='0 0 10 10'>
<circle stroke=#000 stroke-width=.8 fill=none cx=5 cy=5 r=3 />
</symbol>  
<symbol id=icon-close viewBox='0 0 10 10'>
<path stroke=#000 d='M5 5L1 1M5 5L9 9M5 5L9 1M5 5L1 9' />
</symbol> 
</svg>
</template>
</head>
<body>
<span id=os13kDesktop></span>
<span class=title>OS13k</span>
<script>
"use strict";const e=[{name:"Help",icon:"â“",src:"help.html?9",open:1,width:380,height:340},{name:"Code Info",icon:"ğŸ‘¨â€ğŸ’»",src:"codeInfo.html?3"},{name:"System",icon:"âš™ï¸",b:[{name:"Test",icon:"ğŸ˜„",src:"system/test.html?5"}]},{name:"Games",icon:"ğŸ®",b:[{name:"Lava Rush",icon:"ğŸŒ‹",c:"Jeremy Burns",src:"games/lavaRush.html?4",width:640,height:400,background:"#000"},{name:"Sn1ke",icon:"ğŸ‘€",src:"games/sn1ke.html",c:"Codegolf Team",width:450,height:330,l:1},{name:"Tetris",icon:"ğŸ†ƒ",c:"Veubeke",src:"games/tetris.html",width:340,height:430},{name:"Queen's Gambit",icon:"<span style=color:#f0f>â™›</span>",src:"games/queensGambit.html?1",width:1290,height:720,j:1},{name:"Free Cell",icon:"â™ ï¸",src:"games/freeCell.html",width:800,height:1e3,l:1},{name:"Digit Dilemma",icon:"<span style=font-family:monospace>â˜»</span>",src:"games/digitDilemma.html?2"},{name:"Hue Jumper",icon:"ğŸŒ²",src:"games/hueJumper.html",width:1290,height:720,j:1}]},{name:"Utilities",icon:"ğŸ”§",b:[{name:"Photo Booth",icon:"ğŸ“¸",src:"utilities/photoBooth.html",width:1380,height:600},{name:"Unicode Toys",icon:"ğ–€",c:"Xem",src:"utilities/unicodeToys.html",width:500,height:800},{name:"Mini Shadertoy",icon:"ğ“¢",src:"utilities/miniShadertoy.html",width:340,height:400}]},{name:"Toys",icon:"ğŸ¤–",b:[{name:"ZzFX Soundboard",icon:"ğ™ğ™",src:"toys/zzfxSoundBoard.html"},{name:"Yin Yangs",icon:"â˜¯ï¸",src:"toys/infiniteYinYangs.shader.txt"},{name:"Vogel Spiral",icon:"ğŸŒ€",src:"toys/vogelSpiral.shader.txt?2"},{name:"Meta OS13k",icon:"ğğ’",src:"index.html"},{name:"ZzArt Landscape",icon:"ğ“©",src:"toys/zzart.shader.txt"}]},{name:"Dweets",icon:"<b>III</b>",b:[{name:"Black Hole",icon:"ğŸŒŒ",src:"dweets/blackHole.dweet.js"},{name:"Mandelbrot Nebula",icon:"ğŸŒŸ",src:"dweets/mandelbrotNebula.dweet.js"},{name:"Bogus Roads",icon:"ğŸ›£ï¸",src:"dweets/bogusRoads.dweet.js"},{name:"Automatic Breakout",icon:"â—",src:"dweets/breakout.dweet.js"},{name:"Underwater Cavern",icon:"ğŸŒŠ",c:"Pavel",src:"dweets/underwaterCavern.dweet.js"},{name:"City Traffic",icon:"ğŸšŒ",c:"Tomxor",src:"dweets/cityTraffic.dweet.js"},{name:"Train Set",icon:"ğŸš‚",c:"jylikangas",src:"dweets/trainSet.dweet.js"}]},{name:"Music",icon:"ğŸ¶",b:[{name:"Min Bytes",icon:"<span style=color:#f00>ğ“œ</span>",width:500,height:500,src:"music/minBytes.html?4"}]},{name:"Favorites",b:[]}];os13kDesktop.a=(()=>{o&&h(o,o=0),this.focus()}),os13kDesktop.h=(()=>os13kDesktop.a());let t=99;class s extends HTMLElement{constructor({x:e,y:t,name:s,icon:o,src:n,width:a=720,height:i=405,c:r,b:h,l:c,u:l,background:d,j:m}){super(),n=n||"",s=s||n.split(".")[0],o=o||(h?"ğŸ“":s[0]?s[0].toUpperCase():""),d=d||"#000",this.attachShadow({mode:"open"}),this.name=s,this.icon=o,this.src=n,this.H=a,this.G=i,this.style.left=e,this.style.top=t,this.c=r,this.l=c||h,this.u=l,this.b=h,this.background=d,this.j=m,e=n?n.split(".")[1]:"",this.m="dweet"==e,this.isShader="shader"==e,(this.m||this.isShader)&&(this.j=1),this.shadowRoot.innerHTML=templateIcon.innerHTML+`<span class=icon>${o}</span>`+`<span class=name style=pointer-events:none>${s}</span>`}o(){this.i&&!this.u?this.i.style.display="":(300<(t+=46)&&(t=119),this.i=new c(t,t,this),os13kDesktop.appendChild(this.i)),this.i.a()}h(){const e=this.parentElement&&this.parentElement.offsetParent;e.a?e.a():os13kDesktop.a()}}customElements.define("os13k-icon",s);let o,n,a,i,r=1e7;function h(e,t=1){t&&(e.style.zIndex=++r,o&&o!=e&&h(o,0)),e.F.style.background=t?"#aac":"#777",o=t?e:0}class c extends HTMLElement{constructor(e,t,o){super(),this.g=o,this.style.left=e,this.style.top=t,this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=templateWindow.innerHTML,(e=this.F=document.createElement("div")).className="titleBar",e.innerHTML="<span id=titleBar class=name>&nbsp;"+o.icon+"&nbsp;"+o.name+"&nbsp;"+(o.c?"("+o.c+")":"")+"</span>"+(o.b?"":"<span id=full class=full><svg><use href=#icon-full></use></svg></span>"+(o.j?"<span id=reload class=reload><svg><use href=#icon-reload></use></svg></span>":""))+"<span id=close class=close><svg><use href=#icon-close></use></svg></span></span>",this.shadowRoot.appendChild(e),(e=document.createElement("div")).style.height=2,this.shadowRoot.appendChild(e);const n=document.createElement("div");if(n.className="folder frame",n.style.width=o.H,n.style.height=o.G,this.B=n,this.shadowRoot.appendChild(n),o.b){let t=24.75,a=24.75;e=(e=>{e.x=t,e.y=a,693<(t+=99)&&(t=24.75,a+=130),n.appendChild(new s(e))});for(const t of o.b)e(t);this.a()}else if(o.src){const e=this.C=document.createElement("iframe");e.className="frame",e.sandbox.add("allow-scripts"),e.sandbox.add("allow-same-origin"),e.sandbox.add("allow-popups"),e.sandbox.add("allow-modals"),e.sandbox.add("allow-pointer-lock"),e.style.display="none",e.src=o.src,o.background&&(n.style.background=o.background),n.appendChild(e),e.onload=(t=>{if((t=this.s=t.target.contentWindow).oncontextmenu=(e=>e.preventDefault()),t.OS13k=m,t.zzfx=d,t.OS13kStart&&t.OS13kStart(),this.g.m||this.g.isShader){const e=t.document,s=e.body.innerText;e.body.innerHTML=`<canvas id=c width=1920 height=1080 style=width:100%;background:${this.g.m?"#fff":"#000"}>`,e.body.style="overflow:hidden;margin:0;background:#000",this.g.m&&t.eval("u=t=>{"+s+"};x=c.getContext`2d`;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&u((60*(frame++/60)-frame-1|0?frame-1:frame)/60));loop(frame=0)"),this.g.isShader&&t.eval("g=c.getContext`webgl2`;x=y=z=w=0;onmousemove=e=>e.buttons&&(x=e.x,y=c.height-e.y);onmousedown=e=>(z=e.x,w=c.height-e.y);onmouseup=e=>z=w=0;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&(c.width=innerWidth,c.height=innerHeight,g.uniform4f(g.getUniformLocation(s,`iMouse`),x,y,z,w),OS13k.RenderShader(c,s,t/1e3)));loop(s=OS13k.CreateShader(c,`"+s+"`))")}e.style.display="",this.a()})}}h(e){if("close"==e&&(this.g.l?this.style.display="none":(this.g.i=0,this.remove())),"reload"==e&&(this.C.style.display="none",this.s.location.reload()),"full"==e){const e=this.B;e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}"titleBar"==e&&(n=this),this.a()}a(){this.s?this.s.focus():os13kDesktop.a(),h(this)}}customElements.define("os13k-window",c),onmousedown=(e=>{if(n)return onmouseup(e);const t=e.originalTarget||e.path[0],s="os13k-icon"==t.localName?t:e.target,o=s.getBoundingClientRect();a=e.x-o.left,i=e.y-o.top,s.h?s.h(t.id):os13kDesktop.h(),os13kDesktop.style.pointerEvents="none",n&&(document.body.style.cursor="grabbing"),e.preventDefault()}),onmouseup=(e=>{os13kDesktop.style.pointerEvents="",document.body.style.cursor="",n&&n.v&&n.v(e),n=0}),onmousemove=(e=>{if(n){const t=m.Clamp(e.y,9,innerHeight-9);n.style.left=m.Clamp(e.x,9,innerWidth-9)-a,n.style.top=t-i}}),ondblclick=(e=>{(e=e.originalTarget||e.path[0]).o&&e.o()}),oncontextmenu=(e=>e.preventDefault());let l=.3;const d=(e=1,t=.05,s=220,o=0,n=0,a=.1,i=0,r=1,h=0,c=0,d=0,u=0,p=0,f=0,g=0,w=0,y=0,S=2*Math.PI,b=44100,k=(e=>2*e*Math.random()-e),x=(e=>0<e?1:-1),T=(h*=500*S/b**2),v=(s*=(1+k(t))*S/b),C=x(g)*S/4,M=[],R=0,E=0,D=0,A=1,B=0,I=0,L=0,P,F)=>{for(c*=500*S/b**3,F=(o=99+o*b|0)+(n=n*b|0)+(a=a*b|0)+(y=y*b|0),g*=S/b,d*=S/b,u*=b,p*=b;D<F;M[D++]=L)++I>100*w&&(I=0,L=R*s*Math.sin(E*g-C),L=x(L=i?1<i?2<i?3<i?Math.sin((L%S)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/S%2+2)%2:1-4*Math.abs(Math.round(L/S)-L/S):Math.sin(L))*Math.abs(L)**r,L*=e*l*(D<o?D/o:D<o+n?1:D<F-y?1-(D-o-n)/a:0),L=y?L/2+(y>D?0:(D<F-y?1:(D-F)/y)*M[D-y]/2):L),R+=1+k(f),E+=1+k(f),s+=h+=c,A&&++A>u&&(s+=d,v+=d,A=0),p&&++B>p&&(s=v,h=T,B=1,A=A||1);return m.PlaySamples(M)},m=new class{constructor(){this.randomSeed=Date.now();{let o=24.75;for(const n of e){var t=n;t.x=o,t.y=24.75,o+=99;const e=new s(t);os13kDesktop.appendChild(e),t.open&&e.o()}}setInterval(this.w,99)}w(){const e=document.activeElement;this.D!=e&&("os13k-window"==e.localName&&e.a(),this.D=e)}KeyDirection(e){let t=0,s=0;return 87!=e&&38!=e||(s+=1),83!=e&&40!=e||--s,68!=e&&39!=e||(t+=1),65!=e&&37!=e||--t,{x:t,y:s}}Medal(){}PlaySeedSound(e,t=1,s=1,o=.05){this.randomSeed=e;const n=(e=(()=>this.Random()))()**3*t/2,a=e()**3*t/2,i=n+a+(t=e()**3*t/2);return d(...[s,o,2e3*e()**2,n,a,t,5*e()|0,3*e()**2,.5>e()?0:e()**3*(.5>e()?-99:99),.5>e()?0:e()**3*(.5>e()?-99:99),.5>e()?0:e()**2*(.5>e()?-1e3:1e3),e()**2*i,.5>e()?0:e()*i,.5>e()?0:e()**4,.5>e()?0:e()**3*(.5>e()?-9:9),.5>e()?0:e()**4,.5>e()?0:e()**3/2])}PlaySamples(e,t=44100){this.f||(this.f=new(AudioContext||webkitAudioContext),this.f.A=this.f.createBufferSource,this.f.createBufferSource=((e=this.f.A())=>(e.start=e.start||e.noteOn,e.stop=e.stop||e.noteOff,e))),t=this.f.createBuffer(1,e.length,t);const s=this.f.createBufferSource();return t.getChannelData(0).set(e),s.buffer=t,s.connect(this.f.destination),s.start(),s}SetVolume(e){l=e}Speak(e){speechSynthesis.speak(new SpeechSynthesisUtterance(e))}CreateShader(e,t){const s=(e=e.getContext("webgl2")).createShader(e.VERTEX_SHADER);e.shaderSource(s,"#version 300 es\nin vec4 p;void main(){gl_Position=p;}"),e.compileShader(s);var o=e.ARRAY_BUFFER;return e.bindBuffer(o,e.createBuffer()),e.bufferData(o,new Int8Array([-3,1,1,-3,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.BYTE,0,0,0),e.getShaderParameter(s,e.COMPILE_STATUS)?(o=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(o,"#version 300 es\nprecision mediump float;uniform float iTime;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;const float pi="+Math.PI+";const float e="+Math.E+";out vec4 outColor;\n"+t+"\nvoid main(){mainImage(outColor,gl_FragCoord.xy);outColor.a=1.;}"),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?(e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t=e.createProgram(),e.attachShader(t,s),e.attachShader(t,o),e.linkProgram(t),e.useProgram(t),t):console.log(e.getShaderInfoLog(o))):console.log(e.getShaderInfoLog(s))}RenderShader(e,t,s=0){const o=e.getContext("webgl2");o.uniform1i(o.getUniformLocation(t,"iChannel0"),0),o.uniform1f(o.getUniformLocation(t,"iTime"),s),o.uniform3f(o.getUniformLocation(t,"iResolution"),e.width,e.height,1),o.viewport(0,0,e.width,e.height),o.drawArrays(o.TRIANGLE_FAN,0,3),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e)}Clamp(e,t=0,s=1){return Math.min(Math.max(e,t),s)}Percent(e,t,s){return s-t?this.Clamp((e-t)/(s-t),0,1):0}Lerp(e,t,s){return t+this.Clamp(e,0,1)*(s-t)}Random(e=1,t=0){return this.randomSeed^=this.randomSeed<<13,this.randomSeed^=this.randomSeed>>17,this.randomSeed^=this.randomSeed<<5,e+Math.abs(this.randomSeed)%1e9/1e9*(t-e)}}
</script>